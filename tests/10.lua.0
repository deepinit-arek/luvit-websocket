#!/usr/bin/env luvit

local sndr = require('../lib/hybi10').sender
local recv = require('../lib/hybi10').receiver

local orig = ('x'):rep(102400)

local fake = {
  buffer = '',
  write = function (self, data, callback)
    --p('WRITTEN', data)
    recv(self, data)
    callback()
  end,
  emit = function (self, event, data, ...)
    assert(orig == data)
    --p('EMIT', event, data)
  end,
}

sndr(fake, orig, function ()
  --p('SENT', orig)
end)
